(this["webpackJsonpplanning-poker"]=this["webpackJsonpplanning-poker"]||[]).push([[0],{14:function(e,t,n){"use strict";var s=n(24),c=n(25),a={prod:!0,log:function(e){this.prod||console.log(e)}},i=new(function(){function e(t){Object(s.a)(this,e),this.client=t}return Object(c.a)(e,[{key:"log",value:function(e){this.client.log(e)}}]),e}())(a);t.a=i},35:function(e,t,n){"use strict";function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.length?a(t?e.reduce((function(e,n){return e+n[t]}),0)/e.length:e.reduce((function(e,t){return e+t}))/e.length,2):0}function c(e){var t=s(e);return a(Math.sqrt(e.map((function(e){return Math.pow(e-t,2)})).reduce((function(e,t){return e+t}))/e.length),2)}function a(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function i(e){return a(s(Object.values(e).filter((function(e){return e.point&&e.point>0})),"point"),1)}n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return i}))},50:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n.n(s),a=n(12),i=n.n(a),r=n(6),o=n(20);function l(e){return e.split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.substring(1)})).join(" ")}function u(e){return(e||"").trim().toLowerCase()}var d="myName",m="trackCheating",j=Object(o.b)({name:"user",initialState:{userName:localStorage.getItem(d)||"",trackCheating:!!localStorage.getItem(m)},reducers:{setUserName:function(e,t){var n=u(t.payload);localStorage.setItem(d,n),e.userName=n},setTrackCheating:function(e,t){localStorage.setItem(m,t.payload),e.trackCheating=t.payload}}}),h=j.actions,b=h.setUserName,f=h.setTrackCheating,O=j.reducer,x=n(33),p="room",v=Object(o.b)({name:"session",initialState:{sessionName:localStorage.getItem(p)||"",confetti:!1,data:{showPoints:0,players:{}}},reducers:{setSessionName:function(e,t){var n=u(t.payload);localStorage.setItem(p,n),e.sessionName=n},setSessionData:function(e,t){var n=Object(x.a)(Object(x.a)({},e.data),t.payload);"object"!==typeof n.players&&(n.players={}),e.data=n},setConfetti:function(e,t){e.confetti=!!t.payload}}}),g=v.actions,N=g.setSessionName,y=g.setSessionData,k=g.setConfetti,_=v.reducer,w=Object(o.a)({devTools:!1,reducer:{user:O,session:_}}),S=n(16),C=n(5),P=(n(50),n(2));var I=function(){var e=Object(r.c)((function(e){return e.user.userName}));return Object(P.jsx)("nav",{className:"navbar navbar-dark bg-dark __header",children:Object(P.jsxs)("div",{className:"container-fluid",children:[Object(P.jsxs)(S.b,{className:"navbar-brand",to:"/",title:"Back To Sign In Page",children:[Object(P.jsx)("img",{src:"img/favicon-192x192.png",alt:"logo",className:"d-inline-block align-top me-2 __header__logo"}),"Planning Poker"]}),Object(P.jsxs)("div",{className:"navbar-text",children:[Object(P.jsx)("img",{className:"__header__profile",alt:"profile",src:"img/profile.svg"}),Object(P.jsx)("span",{className:"ms-1",children:l(e)||"Guest"})]})]})})},V=n(17);var A=function(){var e=Object(r.b)(),t=Object(C.f)(),n=Object(r.c)((function(e){return e.session.sessionName})),c=Object(r.c)((function(e){return e.user.userName})),a=Object(s.useState)(n),i=Object(V.a)(a,2),o=i[0],l=i[1],d=Object(s.useState)(c),m=Object(V.a)(d,2),j=m[0],h=m[1];return Object(P.jsxs)("div",{className:"py-5",children:[Object(P.jsx)("h1",{className:"mb-5 text-center text-white",children:"Sign In"}),Object(P.jsxs)("form",{className:"w-50 mx-auto text-light",onSubmit:function(n){n.preventDefault(),o&&j&&(e(b(j)),t.push("/".concat(o)))},children:[Object(P.jsxs)("div",{className:"mb-3",children:[Object(P.jsx)("label",{htmlFor:"room",className:"form-label",children:"Session Name"}),Object(P.jsx)("input",{type:"text",className:"form-control",required:!0,id:"session_name",name:"session_name",placeholder:"e.g. avengers/fantastic4...",value:o,onChange:function(e){return l(u(e.target.value))}})]}),Object(P.jsxs)("div",{className:"mb-4",children:[Object(P.jsx)("label",{htmlFor:"username",className:"form-label",children:"Your Nickname"}),Object(P.jsx)("input",{type:"text",className:"form-control",required:!0,id:"user_name",name:"user_name",placeholder:"Please pick a unique nickname...",value:j,onChange:function(e){return h(u(e.target.value))}})]}),Object(P.jsxs)("div",{children:[Object(P.jsx)("button",{type:"submit",className:"btn btn-primary px-4",children:"Join Session"}),Object(P.jsx)("span",{className:"me-2 ms-3",children:"OR"}),Object(P.jsx)(S.b,{to:"/".concat(o,"?observer"),className:"text-primary",children:"Join As Observer"})]})]})]})},T=n(35);var D=n(24),F=n(25),L=n(32),E=(n(55),n(14)),H=new(function(){function e(t){Object(D.a)(this,e),L.a.initializeApp(t),this.db=L.a.database(),this.sessionName="",this.userName="",E.a.log("new FirebaseClient()")}return Object(F.a)(e,[{key:"initialize",value:function(e,t){var n=this;(console.info("DB connected"),this.online(),this.sessionName=e,this.userName=t,this.userName)&&(this.setPoint(0),this.db.ref(".info/connected").on("value",(function(e){if(!0===e.val()){var t=n.db.ref(n.sessionName+"/players/"+n.userName+"/connected");t.onDisconnect().remove(),t.set(!0)}})))}},{key:"setPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={"/point":e,"/connected":!0,"/cheated":t};this.db.ref(this.sessionName+"/players/"+this.userName).update(n).catch(this.errorHandler)}},{key:"clearVotes",value:function(){var e=this;this.db.ref(this.sessionName).once("value").then((function(t){var n=t.val(),s={time:(new Date).toISOString(),showPoints:0,players:{}};for(var c in n.players)s.players[c]={point:0,cheated:!1,connected:!!n.players[c].connected};e.db.ref(e.sessionName).set(s).catch(e.errorHandler)})).catch(this.errorHandler)}},{key:"showVotes",value:function(){this.db.ref(this.sessionName+"/showPoints").set(1).catch(this.errorHandler)}},{key:"deletePlayer",value:function(e){e&&this.db.ref(this.sessionName+"/players/"+e).remove().catch(this.errorHandler)}},{key:"attachListener",value:function(e){this.db.ref(this.sessionName).off(),this.db.ref(this.sessionName).on("value",e),console.info("Watching session: "+this.sessionName)}},{key:"detachListener",value:function(){this.db.ref(this.sessionName).off(),this.db.ref(".info/connected").off(),console.info("Detach listener: "+this.sessionName)}},{key:"online",value:function(){this.db.goOnline()}},{key:"offline",value:function(){console.info("DB disconnected"),this.db.goOffline()}},{key:"errorHandler",value:function(e){console.error(e)}}]),e}())({apiKey:"AIzaSyAW076Ai3lOBhONLt8pKfUA0jedjf5A7RY",authDomain:"planning-poker-remax.firebaseapp.com",databaseURL:"https://planning-poker-remax.firebaseio.com",projectId:"planning-poker-remax",storageBucket:"planning-poker-remax.appspot.com",messagingSenderId:"1050364771989",appId:"1:1050364771989:web:a5c621b239496dfaf9e59c"}),B=n(66),R=document.getElementById("modal");var M=function(e){var t=e.title,n=e.body,c=e.confirmText,i=e.confirmHandler,r=e.setVisibility,o=document.createElement("div"),l=Object(s.useRef)(null);return Object(s.useEffect)((function(){return R.appendChild(o),window.setTimeout((function(){l.current.className+=" show"}),100),function(){return R.removeChild(o)}}),[o]),Object(a.createPortal)(Object(P.jsxs)(s.Fragment,{children:[Object(P.jsx)("div",{className:"modal-backdrop fade show"}),Object(P.jsx)("div",{ref:l,className:"modal d-block fade",children:Object(P.jsx)("div",{className:"modal-dialog",children:Object(P.jsxs)("div",{className:"modal-content",children:[Object(P.jsx)("div",{className:"modal-header border-0",children:Object(P.jsx)("h5",{className:"modal-title",children:t})}),n&&Object(P.jsx)("div",{className:"modal-body",children:n}),Object(P.jsxs)("div",{className:"modal-footer border-0",children:[Object(P.jsx)("button",{type:"button",className:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:function(){r(!1)},children:"Cancel"}),Object(P.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){i(),r(!1)},children:c})]})]})})})]}),o)};n(57);function J(e){var t=e.name,n=e.player,c=e.showVotes;E.a.log("Player render()");var a="none";n.connected?c?a="front":0!==n.point&&(a="back"):a="offline";var i=Object(s.useState)(!1),o=Object(V.a)(i,2),u=o[0],d=o[1],m=Object(r.c)((function(e){return e.user})),j=c&&n.cheated&&n.connected;return Object(P.jsxs)("div",{className:"text-center __player",onContextMenu:function(e){e.preventDefault(),d(!0)},children:[Object(P.jsx)("div",{className:"mx-auto __player__container",children:Object(P.jsxs)("div",{className:"__player__container__warpper",children:[Object(P.jsx)(B.a,{in:"offline"===a,unmountOnExit:!0,exit:!1,timeout:300,classNames:"card",children:Object(P.jsx)("img",{src:"img/offline.png"})}),Object(P.jsx)(B.a,{in:"back"===a,unmountOnExit:!0,exit:!1,timeout:300,classNames:"card",children:Object(P.jsx)("img",{src:"img/back.png"})}),Object(P.jsx)(B.a,{in:"front"===a,unmountOnExit:!0,exit:!1,timeout:300,classNames:"card",children:Object(P.jsx)("img",{src:"img/".concat(n.point,".png")})}),m.trackCheating&&j&&Object(P.jsx)("img",{src:"img/cheat.gif",width:"62",title:"Vote has been changed. It's magic!"})]})}),Object(P.jsx)("div",{className:"".concat(m.userName===t?"text-warning":""," __player__name"),children:l(t)}),u&&Object(P.jsx)(M,{title:'Remove Player "'.concat(t,'" ?'),body:Object(P.jsx)("i",{children:"* Players can join as observers if they don't intend to vote."}),setVisibility:d,confirmText:"Remove",confirmHandler:function(){return H.deletePlayer(t)}})]})}function z(e,t){return JSON.stringify(e)===JSON.stringify(t)}var U=c.a.memo(J,z);function q(){return Object(P.jsx)("div",{className:"d-flex justify-content-center",children:Object(P.jsx)("div",{className:"spinner-border",role:"status",children:Object(P.jsx)("span",{className:"visually-hidden",children:"Loading..."})})})}var Y=c.a.memo(q);n(58);var K=function(e){var t=e.players,n=e.showVotes,s=Object.keys(t).map((function(e){return Object(P.jsx)(U,{name:e,player:t[e],showVotes:n},e)})),c="sm";return s.length>=9&&s.length<=10?c="md":s.length>=11&&(c="lg"),Object(P.jsx)("div",{className:"w-100 h-100 d-flex flex-wrap justify-content-around align-items-center mx-auto __table--".concat(c),children:s.length?s:Object(P.jsx)(Y,{})})},W=(n(59),[.5,1,2,3,5,8,13,-1]);function G(e){var t=e.userPoint,n=e.showVotes,s=W.map((function(e){return Object(P.jsx)("a",{className:"__cards__card ".concat(t===e?"__cards__card--active":""),onClick:function(){return H.setPoint(e,t!==e&&n)},onContextMenu:function(){},children:Object(P.jsx)("img",{className:"position-relative",src:"img/".concat(e,".png"),alt:e})},e)}));return Object(P.jsx)("div",{className:"d-flex justify-content-center __cards",children:s})}var Q=c.a.memo(G),X=c.a.lazy((function(){return Promise.all([n.e(2),n.e(4)]).then(n.bind(null,198))}));function Z(){E.a.log("Setting render()");var e=Object(r.b)(),t=Object(s.useState)(!1),n=Object(V.a)(t,2),c=n[0],a=n[1],i=Object(r.c)((function(e){return e.user.trackCheating})),o=Object(r.c)((function(e){return e.session.sessionName}));return Object(P.jsxs)("div",{children:[Object(P.jsxs)("div",{className:"mt-5 text-secondary text-center",children:[Object(P.jsx)("h4",{className:"--with-dash",children:"Setting & Help"}),Object(P.jsxs)("div",{className:"d-flex justify-content-center",children:[Object(P.jsxs)("div",{className:"form-check form-switch mx-2",children:[Object(P.jsx)("input",{className:"form-check-input",type:"checkbox",id:"checkboxAnalytics",checked:c,onChange:function(e){return a(e.target.checked)}}),Object(P.jsx)("label",{className:"form-check-label",htmlFor:"checkboxAnalytics",children:"Show analytics"})]}),Object(P.jsxs)("div",{className:"form-check form-switch mx-2",children:[Object(P.jsx)("input",{className:"form-check-input",type:"checkbox",id:"checkboxCheating",checked:i,onChange:function(t){return e(f(t.target.checked))}}),Object(P.jsx)("label",{className:"form-check-label",htmlFor:"checkboxCheating",children:"Track cheating"})]}),Object(P.jsxs)("div",{children:[Object(P.jsx)("span",{className:"ms-2 me-3",children:"|"}),"To remove a player, right click the name"]})]})]}),c&&Object(P.jsx)(s.Suspense,{fallback:Object(P.jsx)(Y,{}),children:Object(P.jsxs)("div",{className:"mt-5 text-secondary ",children:[Object(P.jsx)("h4",{className:"text-center --with-dash",children:"Analytics"}),Object(P.jsx)(X,{sessionName:o})]})})]})}var $=c.a.memo(Z);n(60);var ee=function(e){var t=e.match,n=e.location;E.a.log("Room render()");var c,a=Object(r.b)(),i=Object(C.f)(),o=u(t.params.sessionName),d=0===n.search.indexOf("?observer"),m=Object(r.c)((function(e){return e.session.data})),j=Object(r.c)((function(e){return d?"":e.user.userName})),h=function(e,t){return e&&e[t]?e[t].point:null}(m.players,j),b=!!m.showPoints||(c=m.players,0===Object.values(c).filter((function(e){return 0===e.point})).length);return b&&function(e){var t=Object.values(e).filter((function(e){return e.connected&&e.point>=0}));return t.length>=2&&t[0].point>0&&t.every((function(e){return e.point===t[0].point}))}(m.players)&&(a(k(!0)),window.setTimeout((function(){return a(k(!1))}),5e3)),Object(s.useEffect)((function(){if(o&&a(N(o)),o&&(j||d))return H.initialize(o,j),H.attachListener((function(e){E.a.log("Session data updated"),a(y(e.val()))})),function(){H.detachListener(),H.offline()};i.push("/")}),[a,i,o,j,d]),Object(P.jsxs)("div",{className:"__room",style:{backgroundImage:"url(".concat("","/img/poker-desk.jpg)")},children:[Object(P.jsx)("div",{className:"d-flex align-items-center justify-content-center __room__session",children:Object(P.jsx)("h1",{className:"text-white mb-0",children:l(o)})}),Object(P.jsx)("div",{className:"mx-auto __room__table",children:Object(P.jsx)(s.Profiler,{id:"TableProfiler",onRender:console.log,children:Object(P.jsx)(K,{players:m.players,showVotes:b})})}),d?Object(P.jsx)("div",{className:"mt-4 pt-5",children:Object(P.jsx)("h4",{className:"text-center text-light --with-dash",children:"You are an observer of this session"})}):Object(P.jsxs)("div",{className:"row",children:[Object(P.jsx)("div",{className:"col-2",children:Object(P.jsx)("button",{className:"btn btn-secondary w-100",onClick:function(){return H.clearVotes()},children:"Clear Votes"})}),Object(P.jsx)("div",{className:"col-8",children:Object(P.jsx)(Q,{userPoint:h,showVotes:b})}),Object(P.jsx)("div",{className:"col-2",children:Object(P.jsx)("button",{className:"btn btn-secondary w-100",onClick:function(){return H.showVotes()},children:b?"Avg = "+Object(T.a)(m.players)+" pt":"Show Votes"})})]}),Object(P.jsx)($,{})]})},te=n(38);var ne=function(e,t){return function(){return Object(r.c)((function(e){var n=e;return t.split(".").forEach((function(e){return n=n[e]})),n}))?Object(P.jsx)(e,{}):null}};n(61);var se=ne((function(){var e=Object(te.a)(Array(20).keys()).map((function(e){return Object(P.jsx)("div",{className:"__confetti__piece"},e)}));return Object(P.jsx)("div",{className:"__confetti",children:e})}),"session.confetti");n(62);var ce=function(){return Object(P.jsx)("div",{className:"mx-auto shadow position-relative __app",children:Object(P.jsxs)(S.a,{children:[Object(P.jsx)(I,{}),Object(P.jsx)("div",{className:"position-relative",children:Object(P.jsxs)(C.c,{children:[Object(P.jsx)(C.a,{path:"/",exact:!0,component:A}),Object(P.jsx)(C.a,{path:"/:sessionName",component:ee})]})}),Object(P.jsx)(se,{})]})})},ae=function(e){e&&e instanceof Function&&n.e(5).then(n.bind(null,197)).then((function(t){var n=t.getCLS,s=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),s(e),c(e),a(e),i(e)}))};n(63);i.a.render(Object(P.jsx)(c.a.StrictMode,{children:Object(P.jsx)(r.a,{store:w,children:Object(P.jsx)(ce,{})})}),document.getElementById("root")),ae()}},[[64,1,3]]]);
//# sourceMappingURL=main.8873b0fa.chunk.js.map